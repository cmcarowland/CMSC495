<!--

Golden Hour App Group 1
UMGC CMSC 495 7385
Shivam Patel, Raymond Rowland, Mariam Ahmed, Katrina Wilhelm, Paul Cooper
November 5, 2025

cityData.html

Handles the display of weather and sunrise/sunset data
for a specified city or geographical coordinates.
-->

{% extends "base.html" %}
{% block title %}City Data - GoldenHour{% endblock %}
{% block content %}
    <section class="hero">
      <h4 class="centered golden">A 'Golden Score' (> 80) represents ideal conditions, calculated using cloud coverage, visibility, and temperature closeness to the 65 - 75Â°F comfort range</h4>
    </section>
    <br>
    <section class="hero">
      <h3 class="centered">{{ city_info['name'] }}, {{ city_info.get('state', '') +', ' }}{{ city_info['country'] }}</h3>
      <p class="centered">Latitude: {{ weather_data.coordinates[0] }} Longitude: {{ weather_data.coordinates[1] }}</p>
      {% if user %}
        {% if is_location_favorited(user, weather_data.coordinates[0], weather_data.coordinates[1]) %}
          <form action='/removeFavorite' method='post' class="centered">
            <input type='hidden' name='latitude' value='{{ weather_data.coordinates[0] }}'/>
            <input type='hidden' name='longitude' value='{{ weather_data.coordinates[1] }}'/>
            <input class="favorite-image" type="image" width="25px" src="{{ url_for('static', filename='resources/icon_star_round.png') }}" />
          </form>
          
        {% else %}
          <input class="favorite-image" width="25px" type="image" 
            src="{{ url_for('static', filename='resources/icon_star_round_outline.png') }}"
            onclick="addToFavorites('{{ url_for('favorite') }}', {{ weather_data.coordinates[0] }}, {{ weather_data.coordinates[1] }}, '{{ city_info['name'] }}', '{{ city_info.get('state', '') }}', '{{ city_info['country'] }}')" 
          />
        {% endif %}
      {% endif %}
      <div class="weather-grid">
        <h4>Date</h4>
        <h4>Sunrise  {{ weather_data.sunrise_dt }}</h4>
        <h4>Sunset  {{ weather_data.sunset_dt }}</h4>
        {% for day in weather_data.days %}  
          <div class="weather-card">
            <h4>{{ day.date }}</h4>
            <h5>Temperature</h5>
            <h5>Weather</h5>
            <h5>Golden Score</h5>
          </div>
          <div class="weather-card">
            <hr width="90%"/>
            {% if day.sunrise_event %}
              <p>{{ day.sunrise_event.temp }} &deg;F</p>
              <img width="48" height="48" src="{{ url_for('static', filename='resources/weather/' + day.sunrise_event.get_image_name() + '.png') }}" alt="Weather icon" />
              {% if day.sunrise_event.calc_golden_score() >= 80 %}
                <p class="golden">{{ day.sunrise_event.calc_golden_score() }} / 100</p>
              {% else %}
                <p>{{ day.sunrise_event.calc_golden_score() }} / 100</p>
              {% endif %}
            {% else %}
              <p>Sunrise already occurred</p>
              <img width="48" height="48" src="{{ url_for('static', filename='resources/weather/n_a.png') }}" alt="Weather icon" />
              <p>0/100</p>
            {% endif %}
          </div>
          <div class="weather-card">
            <hr width="90%"/>
            {% if day.sunset_event %}
              <p>{{ day.sunset_event.temp }} &deg;F</p>
              <img width="48" height="48" src="{{ url_for('static', filename='resources/weather/' + day.sunset_event.get_image_name() + '.png') }}" alt="Weather icon" />
              {% if day.sunset_event.calc_golden_score() >= 80 %}
                <p class="golden">{{ day.sunset_event.calc_golden_score() }} / 100</p>
              {% else %}
                <p>{{ day.sunset_event.calc_golden_score() }} / 100</p>
              {% endif %}
            {% else %}
              {% if day.sunrise_event %}
                <p>Sunset too far to forecast</p>
              {% else %}
                <p>Sunset already occurred</p>
              {% endif %}
              
              <img width="48" height="48" src="{{ url_for('static', filename='resources/weather/n_a.png') }}" alt="Weather icon" />
              <p>0/100</p>

            {% endif %}
          </div>
        {% endfor %}
      </div>
    </section>
    <br>
    <button id="back">Go Back</button>
  </main>

  <dialog id="errorDialog" class="error-dialog">
    <p id="dialogMessage"></p>
    <button autofocus>Close</button>
  </dialog>
{% endblock %}
  
{% block scripts %}
  <script>
    document.querySelector('#back').addEventListener('click', function() {
      window.location.href = "{{ url_for('index') }}";
    });

    const dialog = document.querySelector('#errorDialog');
    const closeButton = dialog ? dialog.querySelector('button') : null;
    closeButton?.addEventListener('click', () => {
        dialog.close();
    });

    const flashedMessages = {{ get_flashed_messages(with_categories=true) | tojson }};
    parseFlashedMessages(flashedMessages, dialog);
  </script>
{% endblock %}
